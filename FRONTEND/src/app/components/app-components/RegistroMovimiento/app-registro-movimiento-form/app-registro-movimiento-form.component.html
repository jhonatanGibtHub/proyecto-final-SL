<div class="modal-overlay" *ngIf="showModal">
    <div class="modal-container" (click)="$event.stopPropagation()">
        <form [formGroup]="movimientoForm" (ngSubmit)="onSubmit()">
            <h1 class="page-tittle">{{ isEditMode ? 'Editar movimiento' : 'Registrar Movimiento' }}</h1>

            <div class="input-container">
                <label for="id_lote">
                    <svg fill="currentColor" class="icono-1" viewBox="0 0 512 512">
                        <path d="M500.787,287.812c0.068-0.068,0.137-0.137,0.205-0.196c7.1-7.117,11.008-16.563,11.008-26.607v-13.542c0-4.719-3.814-8.533-8.533-8.533h-23.953L322.193,176c-4.343-1.749-9.344,0.367-11.093,4.762c-1.749,4.369,0.384,9.336,4.762,11.085l117.692,47.087H81.741l146.68-54.323c7.543,12.075,20.855,20.19,36.113,20.19c23.526,0,42.667-19.14,42.667-42.667c0-20.608-14.686-37.845-34.133-41.805v-10.257c19.447-3.968,34.133-21.205,34.133-41.805V8.533c0-4.719-3.814-8.533-8.533-8.533s-8.533,3.814-8.533,8.533v25.822c-7.151-5.419-15.957-8.755-25.6-8.755c-9.643,0-18.449,3.337-25.6,8.755V8.533c0-4.719-3.814-8.533-8.533-8.533s-8.533,3.814-8.533,8.533v59.733c0,20.599,14.686,37.837,34.133,41.805V128c0,4.719,3.814,8.533,8.533,8.533c14.114,0,25.6,11.486,25.6,25.6s-11.486,25.6-25.6,25.6c-7.876,0-14.848-3.652-19.541-9.267l19.422-7.185l5.513,2.202c1.033,0.418,2.108,0.606,3.166,0.606c3.379,0,6.579-2.022,7.927-5.367c1.749-4.369-0.375-9.335-4.762-11.085l-8.559-3.43c-0.384-0.154-0.785-0.119-1.178-0.213c-0.623-0.154-1.22-0.341-1.869-0.35c-0.657-0.008-1.263,0.162-1.894,0.299c-0.393,0.085-0.794,0.043-1.195,0.188l-22.596,8.371c0-0.128-0.034-0.239-0.034-0.367c0-4.719-3.814-8.533-8.533-8.533s-8.533,3.814-8.533,8.533c0,2.21,0.324,4.335,0.657,6.46l-189.918,70.34H8.533c-4.719,0-8.533,3.814-8.533,8.533v13.559c0,9.916,4.028,19.618,11.034,26.624c3.891,3.874,6.033,9.045,6.033,14.541v146.56c0,5.325-2.133,10.547-5.862,14.362c-0.06,0.068-0.128,0.137-0.196,0.196C3.908,470.426,0,479.872,0,489.916v13.551C0,508.186,3.814,512,8.533,512h494.933c4.719,0,8.533-3.814,8.533-8.533v-13.534c0-9.882-4.002-19.567-11.059-26.633c-3.814-3.84-6.007-9.131-6.007-14.532V302.182C494.933,296.772,497.007,291.678,500.787,287.812z M85.333,460.8c0,4.719-3.814,8.533-8.533,8.533s-8.533-3.814-8.533-8.533V290.133c0-4.719,3.814-8.533,8.533-8.533s8.533,3.814,8.533,8.533V460.8z M136.533,460.8c0,4.719-3.814,8.533-8.533,8.533s-8.533-3.814-8.533-8.533V290.133c0-4.719,3.814-8.533,8.533-8.533s8.533,3.814,8.533,8.533V460.8z M187.733,460.8c0,4.719-3.814,8.533-8.533,8.533s-8.533-3.814-8.533-8.533V290.133c0-4.719,3.814-8.533,8.533-8.533s8.533,3.814,8.533,8.533V460.8z M238.933,460.8c0,4.719-3.814,8.533-8.533,8.533s-8.533-3.814-8.533-8.533V290.133c0-4.719,3.814-8.533,8.533-8.533s8.533,3.814,8.533,8.533V460.8z M290.133,460.8c0,4.719-3.814,8.533-8.533,8.533c-4.719,0-8.533-3.814-8.533-8.533V290.133c0-4.719,3.814-8.533,8.533-8.533c4.719,0,8.533,3.814,8.533,8.533V460.8z M341.333,460.8c0,4.719-3.814,8.533-8.533,8.533c-4.719,0-8.533-3.814-8.533-8.533V290.133c0-4.719,3.814-8.533,8.533-8.533c4.719,0,8.533,3.814,8.533,8.533V460.8z M392.533,460.8c0,4.719-3.814,8.533-8.533,8.533c-4.719,0-8.533-3.814-8.533-8.533V290.133c0-4.719,3.814-8.533,8.533-8.533c4.719,0,8.533,3.814,8.533,8.533V460.8z M443.733,460.8c0,4.719-3.814,8.533-8.533,8.533s-8.533-3.814-8.533-8.533V290.133c0-4.719,3.814-8.533,8.533-8.533s8.533,3.814,8.533,8.533V460.8z"/>
                    </svg>
                    <span>Lote a distribuir</span>
                </label>
                <div class="input" [ngClass]="{'is-invalid': isFieldInvalid('id_lote')}">
                    <mat-form-field appearance="outline">
                        <mat-select id="id_lote" formControlName="id_lote" (selectionChange)="onLoteSeleccionado($event)">
                            <mat-option value="">Seleccione un lote</mat-option>
                            <mat-option *ngFor="let item of lotes" [value]="item.id_lote">
                                <strong>{{ item.vacuna }}</strong> {{ item.cantidad_inicial_unidades }} u
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>  
                <div *ngIf="isFieldInvalid('id_lote')" class="text-error-message">
                    <small>{{ getErrorMessage('id_lote') }}</small>
                </div>
            </div>

            <div class="input-container">
                <label for="ubicacion_origen">
                    <svg class="icono-1" viewBox="0 0 24 24" fill="none">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    <span>Ubicación Distribuidor</span>
                </label>
                <div class="input" [ngClass]="{'is-invalid': isFieldInvalid('ubicacion_origen')}">
                    <mat-form-field appearance="outline">
                        <mat-select id="ubicacion_origen" formControlName="ubicacion_origen">
                            <mat-option value="">Seleccione ubicación de origen</mat-option>
                            <mat-option *ngFor="let item of ubicaciones_distribuidores" [value]="item.id_ubicacion">
                               {{ item.nombre }} | <strong>{{ item.direccion }}</strong>
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div *ngIf="isFieldInvalid('ubicacion_origen')" class="text-error-message">
                    <small>{{ getErrorMessage('ubicacion_origen') }}</small>
                </div>
            </div>

            <div class="input-container">
                <label for="ubicacion_destino">
                    <svg class="icono-1" viewBox="0 0 24 24" fill="none">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    <span>Ubicación Cliente</span>
                </label>
                <div class="input" [ngClass]="{'is-invalid': isFieldInvalid('ubicacion_destino')}">
                    <mat-form-field appearance="outline">
                        <mat-select id="ubicacion_destino" formControlName="ubicacion_destino">
                            <mat-option value="">Seleccione ubicación destino</mat-option>
                            <mat-option *ngFor="let item of inventarios_clientes" [value]="item.id_ubicacion">
                                {{item.nombre_vacuna}} | {{ item.nombre_ubicacion }} | <strong>{{ item.direccion }}</strong>
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div *ngIf="isFieldInvalid('ubicacion_destino')" class="text-error-message">
                    <small>{{ getErrorMessage('ubicacion_destino') }}</small>
                </div>
            </div>

            <div class="input-container">
                <label for="id_transportista">
                    <svg fill="currentColor" class="icono-1" viewBox="0 0 50 50">
                        <path d="M2.84375 13C1.273438 13 0 14.277344 0 15.84375L0 42C0 43.566406 1.429688 45 3 45L7.09375 45C7.570313 47.835938 10.03125 50 13 50C15.96875 50 18.429688 47.835938 18.90625 45L28.15625 45C29.722656 45 31 43.722656 31 42.15625L31 15.90625C31 14.304688 29.738281 13 28.1875 13Z M33 20L33 45C33.480469 47.832031 36.03125 50 39 50C41.96875 50 44.429688 47.832031 44.90625 45L47 45C48.570313 45 50 43.570313 50 42L50 32.375C50 30.363281 48.550781 28.308594 48.375 28.0625L44.21875 22.5C43.265625 21.351563 41.769531 20 40 20Z M38 25L43.59375 25L46.78125 29.25C47.121094 29.730469 48 31.203125 48 32.375L48 33L38 33C37 33 36 32 36 31L36 27C36 25.894531 37 25 38 25Z M13 40C15.207031 40 17 41.792969 17 44C17 46.207031 15.207031 48 13 48C10.792969 48 9 46.207031 9 44C9 41.792969 10.792969 40 13 40Z M39 40C41.207031 40 43 41.792969 43 44C43 46.207031 41.207031 48 39 48C36.792969 48 35 46.207031 35 44C35 41.792969 36.792969 40 39 40Z"/>
                    </svg>
                    <span>Transportista</span>
                </label>
                <div class="input" [ngClass]="{'is-invalid': isFieldInvalid('id_transportista')}">
                    <mat-form-field appearance="outline">
                        <mat-select id="id_transportista" formControlName="id_transportista">
                            <mat-option value="">Seleccione un transportista</mat-option>
                            <mat-option *ngFor="let item of transportistas" [value]="item.id_transportista">
                                {{ item.nombre }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div *ngIf="isFieldInvalid('id_transportista')" class="text-error-message">
                    <small>{{ getErrorMessage('id_transportista') }}</small>
                </div>
            </div>

            <div class="input-container">
                <label for="fecha_envio">
                    <svg class="icono-1" viewBox="0 0 24 24" fill="none">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="1.5"/>
                        <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    <span>Fecha de Envío</span>
                </label>
                <div class="input" [ngClass]="{'is-invalid': isFieldInvalid('fecha_envio')}">
                    <mat-form-field appearance="outline">
                        <input matInput [matDatepicker]="picker1" formControlName="fecha_envio" [min]="today" />
                        <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                        <mat-datepicker #picker1></mat-datepicker>
                    </mat-form-field>
                </div>
                <div *ngIf="isFieldInvalid('fecha_envio')" class="text-error-message">
                    <small>{{ getErrorMessage('fecha_envio') }}</small>
                </div>
            </div>

            <div class="flex-end" style="margin-top: 30px;">
                <button type="submit" class="btn btn-blue">
                    <svg class="icono-1" viewBox="0 0 24 24" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M18.1716 1C18.702 1 19.2107 1.21071 19.5858 1.58579L22.4142 4.41421C22.7893 4.78929 23 5.29799 23 5.82843V20C23 21.6569 21.6569 23 20 23H4C2.34315 23 1 21.6569 1 20V4C1 2.34315 2.34315 1 4 1H18.1716ZM4 3C3.44772 3 3 3.44772 3 4V20C3 20.5523 3.44772 21 4 21L5 21L5 15C5 13.3431 6.34315 12 8 12L16 12C17.6569 12 19 13.3431 19 15V21H20C20.5523 21 21 20.5523 21 20V6.82843C21 6.29799 20.7893 5.78929 20.4142 5.41421L18.5858 3.58579C18.2107 3.21071 17.702 3 17.1716 3H17V5C17 6.65685 15.6569 8 14 8H10C8.34315 8 7 6.65685 7 5V3H4ZM17 21V15C17 14.4477 16.5523 14 16 14L8 14C7.44772 14 7 14.4477 7 15L7 21L17 21ZM9 3H15V5C15 5.55228 14.5523 6 14 6H10C9.44772 6 9 5.55228 9 5V3Z" fill="currentColor"/>
                    </svg>
                    <span>{{ isEditMode ? 'Actualizar Movimiento' : 'Guardar Movimiento' }}</span>
                </button>
                <button type="button" class="btn btn-secondary" (click)="onCancel()">
                    <svg class="icono-1" viewBox="0 0 512 512" version="1.1" xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink" fill="#000000">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
            <g id="SVGRepo_iconCarrier">
              <title>cancel</title>
              <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="work-case" fill="#000000" transform="translate(91.520000, 91.520000)">
                  <polygon id="Close"
                    points="328.96 30.2933333 298.666667 1.42108547e-14 164.48 134.4 30.2933333 1.42108547e-14 1.42108547e-14 30.2933333 134.4 164.48 1.42108547e-14 298.666667 30.2933333 328.96 164.48 194.56 298.666667 328.96 328.96 298.666667 194.56 164.48">
                  </polygon>
                </g>
              </g>
            </g>
          </svg>
                    <span>Cancelar</span>
                </button>
            </div>
        </form>
    </div>
</div>
